# Module 01: Snowflakeを始める

Snowflakeの基本操作を学び、仮想ウェアハウス、クエリキャッシュ、データ変換、コスト管理の基礎を習得します。

---

## 📋 概要

**所要時間**: 約45分

### 学習目標

このモジュールを完了すると、以下ができるようになります：

- ✅ 仮想ウェアハウスの作成・設定・スケーリング
- ✅ クエリ結果キャッシュの仕組みと活用
- ✅ ゼロコピークローンによる開発環境の作成
- ✅ Time Travel（UNDROP）によるデータ復旧
- ✅ リソースモニターによるコスト管理
- ✅ 予算の設定と監視
- ✅ ユニバーサル検索の活用

---

## 📚 トピック

### 1. 仮想ウェアハウスと設定

**コンセプト**: ウェアハウスはSnowflakeのコンピュートリソースです。

```
ウェアハウスサイズ: X-Small → Small → Medium → Large → X-Large → ... → 6X-Large
                    ↑                                                    ↑
                  最小コスト                                         最大パフォーマンス
```

**主要パラメータ**:
- `WAREHOUSE_SIZE`: コンピュートリソースの量
- `AUTO_SUSPEND`: 非アクティブ時の自動停止（秒）
- `AUTO_RESUME`: クエリ時の自動再開

### 2. 永続化されたクエリ結果（クエリキャッシュ）

**コンセプト**: 同じクエリの結果は24時間キャッシュされます。

```
初回実行: データベース → コンピュート → 結果（数秒）
2回目:   キャッシュ → 結果（ミリ秒）
```

**ポイント**:
- キャッシュはCloud Services層に存在
- ウェアハウス間で共有
- コスト削減に効果的

### 3. 基本的なデータ変換テクニック

**ゼロコピークローン**:
```sql
CREATE TABLE new_table CLONE original_table;
```
- 追加ストレージ不要
- 即座に完了
- 開発・テスト環境に最適

**VARIANTデータの操作**:
```sql
-- コロン演算子でキーにアクセス
SELECT column:key::STRING FROM table;
```

### 4. UNDROPによるデータ復旧

**Time Travel**: データ保持期間内なら削除したオブジェクトを復元可能

```sql
-- 誤って削除
DROP TABLE my_table;

-- 復元！
UNDROP TABLE my_table;
```

### 5. リソースモニター

**コンセプト**: クレジット使用量の監視とアクション

```
使用量 → 75%: 通知
使用量 → 90%: 一時停止（新規クエリ拒否）
使用量 → 100%: 即座に一時停止（実行中クエリもキャンセル）
```

### 6. 予算

**コンセプト**: より柔軟なコスト管理

- 任意のSnowflakeオブジェクト/サービスを対象
- 支出制限の設定
- メール通知

### 7. ユニバーサル検索

**コンセプト**: アカウント内のオブジェクトを自然言語で検索

- データベース、テーブル、ビューの検索
- Marketplaceリストの検索
- ドキュメントの検索

---

## 🔧 ハンズオン手順

### Step 1: コンテキストの設定

```sql
USE DATABASE tb_101;
USE ROLE accountadmin;
```

### Step 2: ウェアハウスの作成と操作

1. ウェアハウスを作成
2. サイズを変更してクエリを実行
3. クエリキャッシュの効果を確認

### Step 3: ゼロコピークローンの作成

1. テーブルをクローン
2. クローンに変更を加える
3. 本番テーブルとスワップ

### Step 4: UNDROPの体験

1. テーブルを削除（ドキドキ！）
2. UNDROPで復元（ホッ）

### Step 5: リソースモニターと予算の設定

1. リソースモニターを作成
2. 予算を作成・設定

### Step 6: ユニバーサル検索の体験

1. 「truck」で検索
2. 自然言語で検索

---

## 📁 ファイル構成

| ファイル | 説明 |
|---------|------|
| `getting_started.sql` | メインSQLスクリプト |
| `reset.sql` | モジュールのリセットスクリプト |
| `slides/` | スライド資料 |

---

## ⚠️ 注意事項

### ウェアハウスのサイズ変更

- サイズ変更は即座に反映されます
- 実行中のクエリには影響しません
- クレジット消費量に注意

### リソースモニターの注意点

- `SUSPEND_IMMEDIATE`は実行中のクエリもキャンセルします
- 本番環境では慎重に設定してください

---

## 🔄 リセット

このモジュールで作成したオブジェクトをクリーンアップする場合：

```sql
-- reset.sql を実行
```

---

## ✅ 確認問題

1. ウェアハウスのAUTO_SUSPENDを60秒に設定した場合、どのタイミングでウェアハウスは停止しますか？

2. クエリ結果キャッシュが無効になる条件は何ですか？

3. ゼロコピークローンが追加ストレージを消費するのはどのような場合ですか？

---

## 📖 参考リンク

- [仮想ウェアハウスの概要](https://docs.snowflake.com/en/user-guide/warehouses-overview)
- [永続化されたクエリ結果](https://docs.snowflake.com/en/user-guide/querying-persisted-results)
- [リソースモニター](https://docs.snowflake.com/en/user-guide/resource-monitors)
- [予算](https://docs.snowflake.com/en/user-guide/budgets)
- [ユニバーサル検索](https://docs.snowflake.com/en/user-guide/ui-snowsight-universal-search)

---

## ➡️ 次のステップ

[Module 02: データパイプライン](../02_data_pipelines/) に進んでください。

